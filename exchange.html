<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Біржа на WebSocket</title>
</head>
<body>
    <h1>Біржа Криптовалют (WebSocket)</h1>

    <h2>Поточний курс: <span id="currentRate">...</span> USD</h2>

    <h3>Ваш Баланс</h3>
    <p>USD: <span id="balanceUSD">1000.00</span></p>
    <p>Криптовалюта: <span id="balanceCrypto">0.00</span> од.</p>

    <hr>
    
    <button onclick="sendAction('buy')">Buy 1 Crypto</button>
    <button onclick="sendAction('sell')">Sell 1 Crypto</button>

    <div id="statusMessage" style="color: red; margin-top: 20px;"></div>

    <script>
        const socket = new WebSocket('ws://localhost:8080'); 
        
        const rateDisplay = document.getElementById('currentRate');
        const balanceUSDDisplay = document.getElementById('balanceUSD');
        const balanceCryptoDisplay = document.getElementById('balanceCrypto');
        const statusMessage = document.getElementById('statusMessage');

        socket.onopen = function() {
            console.log('WebSocket підключено.');
        };

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            statusMessage.textContent = ''; 

            if (data.type === 'rate') {
                rateDisplay.textContent = parseFloat(data.rate).toFixed(2); 
            } 
        
            else if (data.type === 'balance') { 
               
                balanceUSDDisplay.textContent = data.data.usd;
                balanceCryptoDisplay.textContent = data.data.crypto;
            } 
    
            else if (data.type === 'error') {
                statusMessage.textContent = 'Помилка: ' + data.message;
            }
        };


        window.sendAction = function(action) { 
            if (socket.readyState === WebSocket.OPEN) {
               
                socket.send(JSON.stringify({ action: action }));
            } else {
                statusMessage.textContent = 'Помилка: З\'єднання не встановлено.';
            }
        }
    </script>
</body>
</html>